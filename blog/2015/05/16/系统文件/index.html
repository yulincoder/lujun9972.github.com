<!DOCTYPE html>
<html lang="en">
<head>
  <title>系统文件 - 浩劫残阳</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="DarkSun" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="http://lujun9972.github.io/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="http://lujun9972.github.io/media/css/comment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
  </script>
  <script type="text/x-mathjax-config">
          MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
  </script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="http://lujun9972.github.io/">浩劫残阳</a></h1>
    <p>=============&gt;随便写写</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="http://lujun9972.github.io/years/">Years</a></li>
        <li><a href="http://lujun9972.github.io/authors/">Authors</a></li>
        <li><a href="http://lujun9972.github.io/tags/">Tags</a></li>
        <li><a href="http://lujun9972.github.io/about/">About</a></li>
        <li><a href="https://github.com/lujun9972">Github</a></li>
        <li><a href="http://lujun9972.github.io/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">系统文件</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. passwd文件</a></li>
<li><a href="#sec-2">2. shadow文件</a></li>
<li><a href="#sec-3">3. group文件</a></li>
<li><a href="#sec-4">4. 其他数据文件</a>
<ul>
<li><a href="#sec-4-1">4.1. hosts文件</a></li>
<li><a href="#sec-4-2">4.2. networks文件</a></li>
<li><a href="#sec-4-3">4.3. protocols文件</a></li>
<li><a href="#sec-4-4">4.4. services文件</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 登录账户记录</a></li>
<li><a href="#sec-6">6. 系统标识</a>
<ul>
<li><a href="#sec-6-1">6.1. uname函数:获取当前主机与操作系统相关信息</a></li>
<li><a href="#sec-6-2">6.2. gethostname函数:只返回主机名</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> passwd文件</h2>
<div class="outline-text-2" id="text-1">
<p>
&lt;pwd.h&gt;中定义了passwd结构体,并提供了获取指定passwd项的函数
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;pwd.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26681;&#25454;uid&#33719;&#21462;passwd&#39033; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">passwd</span> *<span style="color: #0000ff;">getpwuid</span>(<span style="color: #228b22;">uid_t</span> <span style="color: #a0522d;">uid</span>);
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26681;&#25454;&#29992;&#25143;&#21517;&#33719;&#21462;passwd&#39033; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">passwd</span> *<span style="color: #0000ff;">getpwname</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">passwd</span>{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_name</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#29992;&#25143;&#21517; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_passwd</span>;              <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21152;&#23494;&#23494;&#30721; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">uid_t</span> <span style="color: #a0522d;">pw_uid</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25968;&#20540;&#29992;&#25143;ID </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">git_t</span> <span style="color: #a0522d;">pw_gid</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25968;&#20540;&#32452;ID </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_gecos</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#27880;&#37322;&#23383;&#27573; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_dir</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21021;&#22987;&#24037;&#20316;&#30446;&#24405; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_shell</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21021;&#22987;shell </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">pw_class</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#29992;&#25143;&#35775;&#38382;&#31867; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">time_t</span> <span style="color: #a0522d;">pw_change</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#19979;&#27425;&#26356;&#25913;&#23494;&#30721;&#26102;&#38388; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">time_t</span> <span style="color: #a0522d;">pw_expire</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#36134;&#25143;&#21040;&#26399;&#26102;&#38388; </span><span style="color: #b22222;">*/</span>
}
</pre>
</div>

<p>
下面三个函数,则提供了遍历获取passwd项的函数
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;pwd.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;passwd&#25991;&#20214;&#21017;&#25171;&#24320;passwd&#25991;&#20214;,&#24182;&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405;&#22788; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setpwent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;passwd&#25991;&#20214;&#21017;&#25171;&#24320;passwd&#25991;&#20214;,&#24182;&#35835;&#21462;&#19979;&#19968;&#26465;passwd&#39033;</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">passwd</span>* <span style="color: #0000ff;">getpwent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20851;&#38381;passwd&#25991;&#20214; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endpwent</span>();
</pre>
</div>
<p>
需要注意的是:
</p>
<ul class="org-ul">
<li>setpwent会自动检查是否已经打开了passwd文件,若打开了,则不会重复打开.
</li>
<li>getpwent会自动在未调用setpwent打开passwd文件的情况下,自动打开该passwd.
</li>
<li>使用getpwent查看完passwd文件后,一定要调用endpwent关闭这些文件.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> shadow文件</h2>
<div class="outline-text-2" id="text-2">
<p>
类似passwd相关函数
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;shadow.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26681;&#25454;&#29992;&#25143;&#21517;&#33719;&#21462;shadow&#39033; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">spwd</span>* <span style="color: #0000ff;">getspnam</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">spwd</span>{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">sp_namp</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#29992;&#25143;&#30331;&#24405;&#21517; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">sp_pwdp</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21152;&#23494;&#21475;&#20196; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_lstchg</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#19978;&#27425;&#26356;&#25913;&#23494;&#30721;&#20197;&#26469;&#32463;&#36807;&#30340;&#26102;&#38388; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_min</span>;                   <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32463;&#36807;&#22810;&#23569;&#22825;&#21518;&#20801;&#35768;&#26356;&#25913;&#23494;&#30721; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_max</span>;                   <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#22810;&#23569;&#22825;&#21518;&#35201;&#27714;&#26356;&#25913;&#23494;&#30721; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_warn</span>;                  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#23494;&#30721;&#21040;&#26399;&#35686;&#21578;&#22825;&#25968; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_inact</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#36134;&#25143;&#22833;&#25928;&#21069;&#22825;&#25968; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_expire</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#36134;&#25143;&#21040;&#26399;&#22825;&#25968; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">unsigned</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sp_flag</span>;         <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20445;&#30041; </span><span style="color: #b22222;">*/</span>
}

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;shadow&#25991;&#20214;&#21017;&#25171;&#24320;shadow&#25991;&#20214;,&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405;&#22788; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setspent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;shadow&#25991;&#20214;&#21017;&#25171;&#24320;shadow&#25991;&#20214;,&#35835;&#21462;&#19979;&#19968;&#26465;shadow&#35760;&#24405;</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">spwd</span>* <span style="color: #0000ff;">getspent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20851;&#38381;shaodw&#25991;&#20214; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endspent</span>();
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> group文件</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;grp.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26681;&#25454;gid&#33719;&#21462;group&#39033; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">group</span>* <span style="color: #0000ff;">getgrgid</span>(<span style="color: #228b22;">gid_t</span> <span style="color: #a0522d;">gid</span>);
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26681;&#25454;&#32452;&#21517;&#31216;,&#33719;&#21462;group&#39033; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">group</span>* <span style="color: #0000ff;">getgrnam</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">group</span>{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">gr_name</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32452;&#21517; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">gr_passwd</span>;              <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21152;&#23494;&#21475;&#20196; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">gr_gid</span>;                   <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32452;id </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">gr_mem</span>;                <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32452;&#25104;&#21592;&#21517;&#31216;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
};
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#19979;&#38754;&#19977;&#20010;&#20989;&#25968;&#29992;&#20110;&#36941;&#21382;group&#39033; </span><span style="color: #b22222;">*/</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;group&#25991;&#20214;&#21017;&#25171;&#24320;group&#25991;&#20214;,&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setgrent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33509;&#26410;&#25171;&#24320;group&#25991;&#20214;&#21017;&#25171;&#24320;group&#25991;&#20214;,&#35835;&#21462;&#19979;&#19968;&#26465;group&#39033;</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">group</span>* <span style="color: #0000ff;">getgrent</span>();
<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20851;&#38381;group&#25991;&#20214; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endgrent</span>();
</pre>
</div>

<p>
但与passwd不同的是,UNIX具有附加组的概念. 为了获取和设置附加组ID,提供了下列三个函数:
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;grp.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;unistd.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33719;&#21462;&#24403;&#21069;&#29992;&#25143;&#30340;&#38468;&#21152;&#32452;&#21015;&#34920;,&#36820;&#22238;&#29992;&#25143;&#38468;&#21152;&#32452;&#30340;&#20010;&#25968;,&#20986;&#38169;&#21017;&#36820;&#22238;-1 </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">getgroups</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">group_array_size</span>,<span style="color: #228b22;">gid_t</span> <span style="color: #a0522d;">group_size</span>[]);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20026;&#24403;&#21069;&#36827;&#31243;&#35774;&#32622;&#38468;&#21152;&#32452; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">setgroups</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">group_array_size</span>,<span style="color: #228b22;">gid_t</span> <span style="color: #a0522d;">group_size</span>[]);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20026;&#36827;&#31243;&#38468;&#21152;&#32452;&#35774;&#32622;&#20026;username&#30340;&#38468;&#21152;&#32452; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">initgroups</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">username</span>,<span style="color: #228b22;">gid_t</span> <span style="color: #a0522d;">base_gid</span>);
</pre>
</div>
<ul class="org-ul">
<li>setgroups只可由超级用户调用,且参数group_array_size不能大于NGROUPS_MAX
</li>
<li>initgroups函数会调用setgroups来设置进程的附加组,因此也只能由超级用户调用.
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 其他数据文件</h2>
<div class="outline-text-2" id="text-4">
<p>
对于hosts,networks,protocols,services等系统文件,UNIX也提供了与passwd类似的函数.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">系统文件说明</th>
<th scope="col" class="left">数据路径</th>
<th scope="col" class="left">头文件</th>
<th scope="col" class="left">结构体</th>
<th scope="col" class="left">附加的关键字查找函数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">主机</td>
<td class="left">/etc/hosts</td>
<td class="left">&lt;netdb.h&gt;</td>
<td class="left">hostent</td>
<td class="left">gethostbyname,gethostbyaddr</td>
</tr>

<tr>
<td class="left">网络</td>
<td class="left">/etc/networks</td>
<td class="left">&lt;netdb.h&gt;</td>
<td class="left">netent</td>
<td class="left">getnetbyname,getnetbyaddr</td>
</tr>

<tr>
<td class="left">协议</td>
<td class="left">/etc/protocols</td>
<td class="left">&lt;netdb.h&gt;</td>
<td class="left">protoent</td>
<td class="left">getprotobyname,getprotobynumber</td>
</tr>

<tr>
<td class="left">服务</td>
<td class="left">/etc/services</td>
<td class="left">&lt;netdb.h&gt;</td>
<td class="left">servent</td>
<td class="left">getservbyname,getservbyport</td>
</tr>
</tbody>
</table>

<p>
一般情况下,每个数据文件都会有三个函数:
</p>
<ul class="org-ul">
<li>set函数

<p>
若尚未打开数据文件,则打开数据文件,并将读指针放到第一条记录处
</p>
</li>

<li>get函数

<p>
若尚未打开数据文件,则打开数据文件,并读取下一条数据项.
</p>

<p>
<b>当到达文件尾端则返回空指针</b>
</p>

<p>
<b>大多数get函数返回指向一个静态结构的指针,如果要保存该内容,则需要复制它</b>
</p>
</li>

<li>end函数

<p>
关闭响应数据文件.
</p>
</li>
</ul>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> hosts文件</h3>
<div class="outline-text-3" id="text-4-1">
<p>
本机信息存放在/etc/hosts中,可以通过调用gethostent查找本机主机信息
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netdb.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33719;&#21462;&#20027;&#26426;&#20449;&#24687; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>* <span style="color: #0000ff;">gethostent</span>();

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">h_name</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20027;&#26426;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">h_aliases</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20027;&#26426;&#21035;&#21517;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">h_addrtype</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#22320;&#22336;&#31867;&#22411; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">h_length</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">length in bytes of address </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">h_addr_list</span>;           <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32593;&#32476;&#22320;&#22336;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20854;&#20182;&#25104;&#21592; </span><span style="color: #b22222;">*/</span>
};

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25171;&#24320;&#20027;&#26426;&#25991;&#20214;,&#37325;&#32622;&#35760;&#24405;&#25351;&#38024; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">sethostent</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">stayopen</span>);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20851;&#38381;&#20027;&#26426;&#25991;&#20214; </span><span style="color: #b22222;">*/</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endhostent</span>();

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>* <span style="color: #0000ff;">gethostbyname</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21442;&#25968;len&#20026;&#21442;&#25968;addr&#30340;&#38271;&#24230;,type&#34920;&#31034;&#26159;IPv4&#36824;&#26159;IPv6 </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>* <span style="color: #0000ff;">gethostbyaddr</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">addr</span>,<span style="color: #228b22;">int</span> <span style="color: #a0522d;">len</span>,<span style="color: #228b22;">int</span> <span style="color: #a0522d;">type</span>);
</pre>
</div>
<ul class="org-ul">
<li>gethostent返回/etc/hosts文件中的下一个条目, <b>若文件没打开,gethostent还会打开它</b>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;unistd.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netdb.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;stdio.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netinet/in.h&gt;</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;arpa/inet.h&gt;</span>

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">show_hostent</span>(<span style="color: #a020f0;">const</span> <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>* <span style="color: #a0522d;">h</span>)
{
  printf(<span style="color: #8b2252;">"h_name=[%s]\n"</span>,h-&gt;h_name);
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">alias</span>=<span style="color: #008b8b;">NULL</span>;
  <span style="color: #a020f0;">for</span>(alias = h-&gt;h_aliases[i];alias !=<span style="color: #008b8b;">NULL</span>;++i){
    printf(<span style="color: #8b2252;">"h_alias=[%s]\n"</span>,alias);
  }
  printf(<span style="color: #8b2252;">"h_addrtype=[%d]"</span>,h-&gt;h_addrtype);
  printf(<span style="color: #8b2252;">"h_length=[%d]"</span>,h-&gt;h_length);
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">fflush(stdout); </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">if(h-&gt;h_addrtype == AF_INET) { </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/*   </span><span style="color: #b22222;">for(i = 0;i &lt; h-&gt;h_length;++i){ </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/*     </span><span style="color: #b22222;">struct in_addr** addresses = (struct in_addr**)h-&gt;h_addr_list; </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/*     </span><span style="color: #b22222;">printf("h_addr=[%d]",addresses[i]-&gt;s_addr); </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/*   </span><span style="color: #b22222;">} </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">} </span><span style="color: #b22222;">*/</span>
}

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">main</span>()
{
  <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">hostent</span>* <span style="color: #a0522d;">h</span> = gethostent();
  show_hostent(h);
  <span style="color: #a020f0;">return</span> 0;
}
</pre>
</div>
</li>
<li>sethostent会打开文件并重置记录指针,参数stayopen为非0时,调用gethostent之后,文件将依然是打开的.
</li>
<li>endhostent关闭主机文件.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> networks文件</h3>
<div class="outline-text-3" id="text-4-2">
<p>
我们使用以下函数获得网络名字和网络编号
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netdb.h&gt;</span>

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">netent</span>* <span style="color: #0000ff;">getnetbyaddr</span>(<span style="color: #228b22;">uint32_t</span> <span style="color: #a0522d;">net</span>,<span style="color: #228b22;">int</span> <span style="color: #a0522d;">type</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">netent</span>* <span style="color: #0000ff;">getnetbyname</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">netent</span>* <span style="color: #0000ff;">getnetent</span>();

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setnetent</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">stayopen</span>);

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endnetent</span>();

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">netent</span>
{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">n_name</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32593;&#32476;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">n_aliases</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32593;&#32476;&#21035;&#21517;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n_addrtype</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#22320;&#22336;&#31867;&#22411;,&#22914;AF_INET </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">uint32_t</span> <span style="color: #a0522d;">n_net</span>;               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#32593;&#32476;&#32534;&#21495;,&#25353;&#32593;&#32476;&#23383;&#33410;&#24207;&#36820;&#22238; </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20854;&#20182;&#25104;&#21592; </span><span style="color: #b22222;">*/</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> protocols文件</h3>
<div class="outline-text-3" id="text-4-3">
<p>
我们可以使用以下函数在协议名字和协议编号之间进行映射
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netdb.h&gt;</span>

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">protoent</span>* <span style="color: #0000ff;">getprotobyname</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">protoent</span>* <span style="color: #0000ff;">getprotobynumber</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">proto</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">protoent</span>* <span style="color: #0000ff;">getprotoent</span>();

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setprotoent</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">stayopen</span>);

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endprotoent</span>();

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">protoent</span>
{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">p_name</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21327;&#35758;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">p_aliases</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21327;&#35758;&#21035;&#21517;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p_proto</span>;                  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21327;&#35758;&#32534;&#21495; </span><span style="color: #b22222;">*/</span>
  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20854;&#20182;&#25104;&#21592; </span><span style="color: #b22222;">*/</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> services文件</h3>
<div class="outline-text-3" id="text-4-4">
<p>
服务由地址的端口号部分表示,每个服务由一个唯一的总所周知的端口号来表示
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;netdb.h&gt;</span>

<span style="color: #b22222;">/* </span><span style="color: #b22222;">proto&#25351;&#26126;&#20102;&#20351;&#29992;&#30340;&#32593;&#32476;&#21327;&#35758; </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">servent</span>* <span style="color: #0000ff;">getservbyname</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>,<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">proto</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">servent</span>* <span style="color: #0000ff;">getservbyport</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">port</span>,<span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">proto</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">getservent</span>();

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">setservent</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">stayopen</span>);

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">endservent</span>();

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">servent</span>
{
  <span style="color: #228b22;">char</span>* <span style="color: #a0522d;">s_name</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26381;&#21153;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span>** <span style="color: #a0522d;">p_aliases</span>;             <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21327;&#35758;&#21035;&#21517;&#21015;&#34920; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p_proto</span>;                  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26381;&#21153;&#20351;&#29992;&#30340;&#32593;&#32476;&#21327;&#35758;&#32534;&#21495;,&#22914;TCP,UDP&#31561; </span><span style="color: #b22222;">*/</span>
};
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 登录账户记录</h2>
<div class="outline-text-2" id="text-5">
<p>
大多数UNIX系统都提供下面两个数据文件:
</p>
<dl class="org-dl">
<dt> utmp文件 </dt><dd>记录当前登录进系统的各个用户
</dd>
<dt> wtmp文件 </dt><dd>跟踪各个登录和注销事件
</dd>
</dl>

<p>
每次写入这两个文件的是包含以下结构的二进制记录:
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #a020f0;">struct</span> <span style="color: #228b22;">utmp</span>{
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">ut_line</span>[8];              <span style="color: #b22222;">/* </span><span style="color: #b22222;">tty&#32534;&#21495; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">ut_name</span>[8];              <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#30331;&#24405;&#21517;,&#27880;&#38144;&#26102;&#20026;&#31354; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">long</span> <span style="color: #a0522d;">ut_time</span>;                 <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#30331;&#24405;/&#27880;&#38144;&#20107;&#20214; </span><span style="color: #b22222;">*/</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 系统标识</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> uname函数:获取当前主机与操作系统相关信息</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;sys/utsname.h&gt;</span>

<span style="color: #228b22;">int</span> <span style="color: #0000ff;">uname</span>(<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">utsname</span>* <span style="color: #a0522d;">name</span>);

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">utsname</span>{
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">sysname</span>[];               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">nodename</span>[];              <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#33410;&#28857;&#21517;&#31216; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">release</span>[];               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#30340;&#21457;&#24067;&#22411;&#21495; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">version</span>[];               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#21457;&#24067;&#29256;&#26412; </span><span style="color: #b22222;">*/</span>
  <span style="color: #228b22;">char</span> <span style="color: #a0522d;">machine</span>[];               <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#30828;&#20214;&#31867;&#22411; </span><span style="color: #b22222;">*/</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> gethostname函数:只返回主机名</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-C"><span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;unistd.h&gt;</span>

<span style="color: #228b22;">ing</span> <span style="color: #0000ff;">gethostname</span>(<span style="color: #228b22;">char</span>* <span style="color: #a0522d;">name</span>,<span style="color: #228b22;">int</span> <span style="color: #a0522d;">bufsize</span>);
</pre>
</div>
<ul class="org-ul">
<li>最大主机名长度为HOST_NAME_MAX
</li>
</ul>
</div>
</div>
</div>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2015-05-16</span>
    <span title="last modification date" class="post-info">2016-01-23</span>
    <span title="tags" class="post-info">:N/A:</span>
    <span title="author" class="post-info"><a href="mailto:Administrator@PC-201510071640">DarkSun</a></span>
  </div>
  <script src="http://lujun9972.github.io/media/js/jquery-2.1.3.min.js"></script>
  <section>
    <h1>Comments</h1>
    <div id="comment-wrap">
      <a class="disqus_label">使用 Disqus 评论</a>
      <a class="ds-label">使用多说评论</a>
    </ul>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
     //var disqus_developer = 1;
     var preempt_signal=false;
     var disqus_identifier = "/blog/2015/05/16/系统文件/";
     var disqus_url = "http://lujun9972.github.io/blog/2015/05/16/系统文件/";
     var disqus_shortname = 'lujun9972';
     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       $('#disqus_thread').css('display','none');
     })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    <div class="ds-thread"></div>
    <script type="text/javascript">
     var duoshuoQuery = {short_name:'lujun9972'};
     (function() {
       var ds = document.createElement('script');
       ds.type = 'text/javascript';ds.async = true;
       ds.src = 'http://static.duoshuo.com/embed.js';
       ds.charset = 'UTF-8';
       (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
       $('.ds-thread').css('display','block');
     })();
    </script>
  </section>
  <script src="http://lujun9972.github.io/media/js/main.js"></script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.x(<a href="http://orgmode.org">Org mode</a> 8.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:Administrator@PC-201510071640">DarkSun</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
      <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </div></body>
</html>
